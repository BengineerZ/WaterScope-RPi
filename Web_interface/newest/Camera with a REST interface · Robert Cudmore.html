<!DOCTYPE html>
<!-- saved from url=(0068)http://blog.cudmore.io/post/2015/12/06/camera-with-a-rest-interface/ -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us" class="gr__blog_cudmore_io"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Camera with a REST interface · Robert Cudmore
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="./Camera with a REST interface · Robert Cudmore_files/poole.css">
  <link rel="stylesheet" href="./Camera with a REST interface · Robert Cudmore_files/syntax.css">
  <link rel="stylesheet" href="./Camera with a REST interface · Robert Cudmore_files/hyde.css">
  <link rel="stylesheet" href="./Camera with a REST interface · Robert Cudmore_files/css">

  <!--
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  -->
  
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://blog.cudmore.io/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="http://blog.cudmore.io/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://blog.cudmore.io/atom.xml">
  
  <!-- added 20151219 -->
  <link rel="alternate" type="application/rss+xml" title="My Site RSS" href="http://blog.cudmore.io/feed.xml">

  <!-- added 20171023 -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script type="text/javascript" async="" src="./Camera with a REST interface · Robert Cudmore_files/analytics.js.download"></script><script async="" src="./Camera with a REST interface · Robert Cudmore_files/js"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-108543852-1');
</script>

    

</head>





  <body class="layout-reverse" data-gr-c-s-loaded="true" style="" cz-shortcut-listen="true">

    <div class="sidebar">
  <!-- <div class="container sidebar-sticky"> %} -->

    
    
    <div id="sidebar">
    <!-- <nav class="sidebar-nav"> -->
      <!-- <a class="sidebar-nav-item" href="">Home</a> -->

      

	  <!-- <script>
  (function() {
    var cx = '014838221913568838622:5bpsoltbvmg';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
 -->
		
		<br>
		<br>
		
		<section id="article">
		  <span class="sidebar-nav-item">Posts</span>
		    
		      » <a class="sidebarlink" href="http://blog.cudmore.io/post/2018/02/02/jekyll-again/">Jekyll Again</a><br>
		    
		      » <a class="sidebarlink" href="http://blog.cudmore.io/post/2018/01/14/nginx+flask+uwsgi+rest/">nginx+flask+uwsgi+rest</a><br>
		    
		      » <a class="sidebarlink" href="http://blog.cudmore.io/post/2017/11/28/startup-mailer/">Startup mailer on a Raspberry Pi</a><br>
		    
		      » <a class="sidebarlink" href="http://blog.cudmore.io/post/2017/11/22/raspian-stretch/">Installing Raspian Stretch on a Raspberry Pi</a><br>
		    
		      » <a class="sidebarlink" href="http://blog.cudmore.io/post/2017/11/01/libav-for-ffmpeg/">libav for ffmpeg</a><br>
		    
		      » <a class="sidebarlink" href="http://blog.cudmore.io/post/2017/10/27/Raspberry-startup-tweet/">Raspberry startup tweet</a><br>
		    
		      » <a class="sidebarlink" href="http://blog.cudmore.io/post/2017/10/22/Home-debian-server-setup/">Home Debian server setup</a><br>
		    
		</section>

		<br>

		<span class="sidebar-nav-item">Tags</span>
		
    		<a style="font-size: 98%" href="http://blog.cudmore.io/tags/#flask">
    		  flask
    		</a>
		
    		<a style="font-size: 110%" href="http://blog.cudmore.io/tags/#python">
    		  python
    		</a>
		
    		<a style="font-size: 134%" href="http://blog.cudmore.io/tags/#raspberry%20pi">
    		  raspberry pi
    		</a>
		
    		<a style="font-size: 87%" href="http://blog.cudmore.io/tags/#data%20acquisition">
    		  data acquisition
    		</a>
		
    		<a style="font-size: 51%" href="http://blog.cudmore.io/tags/#bokeh">
    		  bokeh
    		</a>
		
    		<a style="font-size: 51%" href="http://blog.cudmore.io/tags/#protocols">
    		  protocols
    		</a>
		
    		<a style="font-size: 87%" href="http://blog.cudmore.io/tags/#osx">
    		  osx
    		</a>
		
    		<a style="font-size: 240%" href="http://blog.cudmore.io/tags/#raspberry">
    		  raspberry
    		</a>
		
    		<a style="font-size: 287%" href="http://blog.cudmore.io/tags/#linux">
    		  linux
    		</a>
		
    		<a style="font-size: 110%" href="http://blog.cudmore.io/tags/#arduino">
    		  arduino
    		</a>
		
    		<a style="font-size: 51%" href="http://blog.cudmore.io/tags/#ScanImage">
    		  ScanImage
    		</a>
		
    		<a style="font-size: 75%" href="http://blog.cudmore.io/tags/#jekyll">
    		  jekyll
    		</a>
		
    		<a style="font-size: 134%" href="http://blog.cudmore.io/tags/#debian">
    		  debian
    		</a>
		
    		<a style="font-size: 51%" href="http://blog.cudmore.io/tags/#github">
    		  github
    		</a>
		
    		<a style="font-size: 63%" href="http://blog.cudmore.io/tags/#video">
    		  video
    		</a>
		
    		<a style="font-size: 75%" href="http://blog.cudmore.io/tags/#analysis">
    		  analysis
    		</a>
		
    		<a style="font-size: 51%" href="http://blog.cudmore.io/tags/#nginx">
    		  nginx
    		</a>
		

		<br>
		<br>

		<section id="article">
		  <span class="sidebar-nav-item">
		  	Links 
			</span>
		  » <a class="sidebarlink" href="http://robertcudmore.org/">robertcudmore.org</a><br>
		  » <a class="sidebarlink" href="http://github.com/cudmore">github.com/cudmore</a><br>
		  » <a class="sidebarlink" href="http://www.flickr.com/cudmore">flickr.com/cudmore</a><br>
		  <!-- <a href="http://blog.cudmore.io/feed.xml"><IMG ALIGN=LEFT WIDTH=20 HEIGHT=20 SRC="images/feed-icon.png"></a><BR> -->
		  
		</section>
  
	</div>
<!--    </nav> -->

  <!-- </div> %} -->
</div>


    <div class="content container">

      <!-- added by bob -->
      <div class="masthead-title">
	      <h3 class="post-title">
	      <span style="font-size:24px;">
          <a href="http://blog.cudmore.io/" title="Home">Robert Cudmore</a>
		  </span>
		  
          
              <span style="font-size:medium;">
              &nbsp;&nbsp;&nbsp;<a href="http://blog.cudmore.io/archive">archive</a>
              </span>
              
              <!-- &nbsp;&nbsp;&nbsp;<small><a href="/archive">archive</a></small> -->
          
              <span style="font-size:medium;">
              &nbsp;&nbsp;&nbsp;<a href="http://blog.cudmore.io/tags">tags</a>
              </span>
              
              <!-- &nbsp;&nbsp;&nbsp;<small><a href="/tags">tags</a></small> -->
          
              <span style="font-size:medium;">
              &nbsp;&nbsp;&nbsp;<a href="http://blog.cudmore.io/search">search</a>
              </span>
              
              <!-- &nbsp;&nbsp;&nbsp;<small><a href="/search">search</a></small> -->
          
              <span style="font-size:medium;">
              &nbsp;&nbsp;&nbsp;<a href="http://blog.cudmore.io/software">software</a>
              </span>
              
              <!-- &nbsp;&nbsp;&nbsp;<small><a href="/software">software</a></small> -->
          
		</h3>

		<hr style="background:#202020; border:0; height:3px">
		
      </div>

      <div class="post">
  <h2 class="post-title">Camera with a REST interface</h2>
  <span class="post-date">06 Dec 2015</span>
  <p>I’ve written a few versions of this. In previous versions I would control everything from a Python prompt, or a complex flask app, or use DIO to trigger video.</p>

<p>In this version I am trying to keep it simple and starting/stopping video and timelapse images with a REST api.</p>

<p>To test this out, I will have a motion sensor on another Pi send a REST command to start video when it senses motion.</p>

<p>VideoServer.py is using a circular stream such that when recording is started, it also saves ‘pre-triggered’ video before recording was started. It can also capture timelapse images while it is recording video. The Raspberry camera is very nice for these two features. I’ve written VideoServer as a class inheriting from <a href="https://docs.python.org/2/library/threading.html">threading.Thread</a> so it can run daemonized as a background thread, otherwise it will block other code.</p>

<ul>
  <li>VideoServer.py, controls the camera with the following interface:
    <ul>
      <li>startArm(), initializes the camera.</li>
      <li>stopArm(), release the camera.</li>
      <li>startVideo(), starts video recording.</li>
      <li>stopVideo(), stops video recording</li>
      <li>doTimelapse=1, starts acquiring timelapse images</li>
      <li>doTimelapse=0, stops acquiring timelapse images</li>
    </ul>
  </li>
  <li>timelapse_app.py, starts a flask webserver which provides a REST api as a wrapper around VideoServer.py:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     http://192.168.1.12:5010/startarm
     http://192.168.1.12:5010/stoparm
     http://192.168.1.12:5010/startvideo
     http://192.168.1.12:5010/stopvideo
     http://192.168.1.12:5010/timelapseon
     http://192.168.1.12:5010/timelapseoff
     http://192.168.1.12:5010/lastimage
</code></pre></div></div>

<p><strong>To Do:</strong> I still need to expose ‘bufferSeconds’ and ‘stillinterval’ to the REST API.</p>

<h3 id="get-the-last-timelapse-image-in-a-browser-or-with-curl">Get the last timelapse image in a browser or with curl</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># display in browser
http://192.168.1.12:5010/lastimage
# save from command line
curl -o http://192.168.1.12:5010/lastimage
</code></pre></div></div>

<h3 id="rsync-the-images-and-video-to-a-remote-host">rsync the images and video to a remote host</h3>

<p>Now I want to get the videos/images off the machine with the camera. There are more options than I can count but here are three:</p>

<ul>
  <li>Push the recorded video/images to another server from within Python/Flask. I’ve done this before with <a href="http://www.paramiko.org/">Paramiko</a> but have always had problems with the code hanging or exceptions thrown when a network connection is lost.</li>
  <li>Have another machine (also running flask) pull the images off the camera machine. This can be done with the /lastimage REST path. This requires the other machine to be running server code itself and to have some sort of timer.</li>
  <li>Use <strong>rsynch</strong> on the machine running the camera to a push videos/images to a remote server and use <strong>cron</strong> to do this at a regular interval.</li>
</ul>

<p>I will use rsynch to push the images to a remote server. Follow <a href="http://troy.jdmz.net/rsync/index.html">this</a> for a really thorough explanation.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># assuming you have a folder 'securitycam' on remote host
rsync -avz /home/pi/video/20151206/ -e ssh cudmore@192.168.1.200:securitycam
</code></pre></div></div>

<p>Make sure you can <a href="http://127.0.0.1:4000/post/2015/05/04/Auto-login-to-ssh-server/">login to remote server</a> without entering a password</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>add this
</code></pre></div></div>

<p>Run rsynch command every 10 minutes with crontab</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crontab -e
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*/10 * * * * /usr/bin/rsync -avz /home/pi/video/20151206/ -e ssh cudmore@192.168.1.200:securitycam
</code></pre></div></div>

<h3 id="here-is-a-gist-with-videoserverpy-and-timelapse_apppy">Here is a gist with VideoServer.py and timelapse_app.py</h3>

<script src="./Camera with a REST interface · Robert Cudmore_files/c4ab92d288cfd1778be5.js.download"></script><link rel="stylesheet" href="./Camera with a REST interface · Robert Cudmore_files/gist-embed-51733eabd598f6dd7e02254bb5e3dc72.css"><div id="gist28695498" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-timelapse_app-py" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-python">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-timelapse_app-py-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-timelapse_app-py-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span> Author: Robert H Cudmore</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-timelapse_app-py-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span> Web: http://robertcudmore.org</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-timelapse_app-py-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span> Date: 20151205</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-timelapse_app-py-LC4" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span>Purpose: Run a Flask webserver to provide a REST interface to VideoServer.py</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-timelapse_app-py-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-timelapse_app-py-LC6" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-timelapse_app-py-LC7" class="blob-code blob-code-inner js-file-line"><span class="pl-s"><span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-timelapse_app-py-LC8" class="blob-code blob-code-inner js-file-line"><span class="pl-s">API</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-timelapse_app-py-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-s">===</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-timelapse_app-py-LC10" class="blob-code blob-code-inner js-file-line"><span class="pl-s">http://server/</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-timelapse_app-py-LC11" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-timelapse_app-py-LC12" class="blob-code blob-code-inner js-file-line"><span class="pl-s">http://server/startarm</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-timelapse_app-py-LC13" class="blob-code blob-code-inner js-file-line"><span class="pl-s">http://server/stoparm</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-timelapse_app-py-LC14" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-timelapse_app-py-LC15" class="blob-code blob-code-inner js-file-line"><span class="pl-s">http://server/startvideo</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-timelapse_app-py-LC16" class="blob-code blob-code-inner js-file-line"><span class="pl-s">http://server/stopvideo</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-timelapse_app-py-LC17" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-timelapse_app-py-LC18" class="blob-code blob-code-inner js-file-line"><span class="pl-s">http://server/timelapseon</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-timelapse_app-py-LC19" class="blob-code blob-code-inner js-file-line"><span class="pl-s">http://server/timelapseoff</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-timelapse_app-py-LC20" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-timelapse_app-py-LC21" class="blob-code blob-code-inner js-file-line"><span class="pl-s"><span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-timelapse_app-py-LC22" class="blob-code blob-code-inner js-file-line"><span class="pl-k">import</span> time, datetime, platform</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-timelapse_app-py-LC23" class="blob-code blob-code-inner js-file-line"><span class="pl-k">import</span> pprint <span class="pl-c"><span class="pl-c">#</span>to print class members</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-timelapse_app-py-LC24" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> flask <span class="pl-k">import</span> Flask, jsonify, send_file, redirect</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-timelapse_app-py-LC25" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-timelapse_app-py-LC26" class="blob-code blob-code-inner js-file-line"><span class="pl-k">import</span> VideoServer</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-timelapse_app-py-LC27" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-timelapse_app-py-LC28" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>starting server at:<span class="pl-pds">'</span></span>, time.strftime(<span class="pl-s"><span class="pl-pds">"</span>%m/<span class="pl-c1">%d</span>/%y<span class="pl-pds">"</span></span>), time.strftime(<span class="pl-s"><span class="pl-pds">"</span>%H:%M:%S<span class="pl-pds">"</span></span>)</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-timelapse_app-py-LC29" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-timelapse_app-py-LC30" class="blob-code blob-code-inner js-file-line">app <span class="pl-k">=</span> Flask(<span class="pl-c1">__name__</span>)</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-timelapse_app-py-LC31" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-timelapse_app-py-LC32" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>starting video server<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-timelapse_app-py-LC33" class="blob-code blob-code-inner js-file-line">v<span class="pl-k">=</span>VideoServer.VideoServer()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-timelapse_app-py-LC34" class="blob-code blob-code-inner js-file-line">v.daemon <span class="pl-k">=</span> <span class="pl-c1">True</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-timelapse_app-py-LC35" class="blob-code blob-code-inner js-file-line">v.start()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-timelapse_app-py-LC36" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-timelapse_app-py-LC37" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">genericresponse</span>():</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-timelapse_app-py-LC38" class="blob-code blob-code-inner js-file-line">    dateStr <span class="pl-k">=</span> time.strftime(<span class="pl-s"><span class="pl-pds">"</span>%m/<span class="pl-c1">%d</span>/%y<span class="pl-pds">"</span></span>)</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-timelapse_app-py-LC39" class="blob-code blob-code-inner js-file-line">    timeStr <span class="pl-k">=</span> time.strftime(<span class="pl-s"><span class="pl-pds">"</span>%H:%M:%S<span class="pl-pds">"</span></span>)</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-timelapse_app-py-LC40" class="blob-code blob-code-inner js-file-line">    ret <span class="pl-k">=</span> dateStr <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> <span class="pl-pds">'</span></span> <span class="pl-k">+</span> timeStr <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> system running on: <span class="pl-pds">'</span></span> <span class="pl-k">+</span> platform.system() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;BR&gt;<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-timelapse_app-py-LC41" class="blob-code blob-code-inner js-file-line">    ret <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;BR&gt;<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-timelapse_app-py-LC42" class="blob-code blob-code-inner js-file-line">    ret <span class="pl-k">+=</span> pprint.pformat(v.<span class="pl-c1">__dict__</span>).replace(<span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>&lt;BR&gt;<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-timelapse_app-py-LC43" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> ret</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-timelapse_app-py-LC44" class="blob-code blob-code-inner js-file-line">    </td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-timelapse_app-py-LC45" class="blob-code blob-code-inner js-file-line"><span class="pl-en">@app.route</span>(<span class="pl-s"><span class="pl-pds">'</span>/startarm<span class="pl-pds">'</span></span>, <span class="pl-v">methods</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-timelapse_app-py-LC46" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">startArm</span>():</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-timelapse_app-py-LC47" class="blob-code blob-code-inner js-file-line">    v.startArm()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-timelapse_app-py-LC48" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> genericresponse()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-timelapse_app-py-LC49" class="blob-code blob-code-inner js-file-line">    </td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-timelapse_app-py-LC50" class="blob-code blob-code-inner js-file-line"><span class="pl-en">@app.route</span>(<span class="pl-s"><span class="pl-pds">'</span>/stoparm<span class="pl-pds">'</span></span>, <span class="pl-v">methods</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-timelapse_app-py-LC51" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">stopArm</span>():</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L52" class="blob-num js-line-number" data-line-number="52"></td>
        <td id="file-timelapse_app-py-LC52" class="blob-code blob-code-inner js-file-line">    v.stopArm()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L53" class="blob-num js-line-number" data-line-number="53"></td>
        <td id="file-timelapse_app-py-LC53" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> genericresponse()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L54" class="blob-num js-line-number" data-line-number="54"></td>
        <td id="file-timelapse_app-py-LC54" class="blob-code blob-code-inner js-file-line">    </td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L55" class="blob-num js-line-number" data-line-number="55"></td>
        <td id="file-timelapse_app-py-LC55" class="blob-code blob-code-inner js-file-line"><span class="pl-en">@app.route</span>(<span class="pl-s"><span class="pl-pds">'</span>/startvideo<span class="pl-pds">'</span></span>, <span class="pl-v">methods</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L56" class="blob-num js-line-number" data-line-number="56"></td>
        <td id="file-timelapse_app-py-LC56" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">startVideo</span>():</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L57" class="blob-num js-line-number" data-line-number="57"></td>
        <td id="file-timelapse_app-py-LC57" class="blob-code blob-code-inner js-file-line">    v.startVideo()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L58" class="blob-num js-line-number" data-line-number="58"></td>
        <td id="file-timelapse_app-py-LC58" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> genericresponse()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L59" class="blob-num js-line-number" data-line-number="59"></td>
        <td id="file-timelapse_app-py-LC59" class="blob-code blob-code-inner js-file-line">    </td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L60" class="blob-num js-line-number" data-line-number="60"></td>
        <td id="file-timelapse_app-py-LC60" class="blob-code blob-code-inner js-file-line"><span class="pl-en">@app.route</span>(<span class="pl-s"><span class="pl-pds">'</span>/stopvideo<span class="pl-pds">'</span></span>, <span class="pl-v">methods</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L61" class="blob-num js-line-number" data-line-number="61"></td>
        <td id="file-timelapse_app-py-LC61" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">stopVideo</span>():</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L62" class="blob-num js-line-number" data-line-number="62"></td>
        <td id="file-timelapse_app-py-LC62" class="blob-code blob-code-inner js-file-line">    v.stopVideo()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L63" class="blob-num js-line-number" data-line-number="63"></td>
        <td id="file-timelapse_app-py-LC63" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> genericresponse()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L64" class="blob-num js-line-number" data-line-number="64"></td>
        <td id="file-timelapse_app-py-LC64" class="blob-code blob-code-inner js-file-line">    </td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L65" class="blob-num js-line-number" data-line-number="65"></td>
        <td id="file-timelapse_app-py-LC65" class="blob-code blob-code-inner js-file-line"><span class="pl-en">@app.route</span>(<span class="pl-s"><span class="pl-pds">'</span>/timelapseon<span class="pl-pds">'</span></span>, <span class="pl-v">methods</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L66" class="blob-num js-line-number" data-line-number="66"></td>
        <td id="file-timelapse_app-py-LC66" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">timelapseon</span>():</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L67" class="blob-num js-line-number" data-line-number="67"></td>
        <td id="file-timelapse_app-py-LC67" class="blob-code blob-code-inner js-file-line">    v.doTimelapse <span class="pl-k">=</span> <span class="pl-c1">1</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L68" class="blob-num js-line-number" data-line-number="68"></td>
        <td id="file-timelapse_app-py-LC68" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> genericresponse()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L69" class="blob-num js-line-number" data-line-number="69"></td>
        <td id="file-timelapse_app-py-LC69" class="blob-code blob-code-inner js-file-line">    </td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L70" class="blob-num js-line-number" data-line-number="70"></td>
        <td id="file-timelapse_app-py-LC70" class="blob-code blob-code-inner js-file-line"><span class="pl-en">@app.route</span>(<span class="pl-s"><span class="pl-pds">'</span>/timelapseoff<span class="pl-pds">'</span></span>, <span class="pl-v">methods</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L71" class="blob-num js-line-number" data-line-number="71"></td>
        <td id="file-timelapse_app-py-LC71" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">timelapseoff</span>():</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L72" class="blob-num js-line-number" data-line-number="72"></td>
        <td id="file-timelapse_app-py-LC72" class="blob-code blob-code-inner js-file-line">    v.doTimelapse <span class="pl-k">=</span> <span class="pl-c1">0</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L73" class="blob-num js-line-number" data-line-number="73"></td>
        <td id="file-timelapse_app-py-LC73" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> genericresponse()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L74" class="blob-num js-line-number" data-line-number="74"></td>
        <td id="file-timelapse_app-py-LC74" class="blob-code blob-code-inner js-file-line">    </td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L75" class="blob-num js-line-number" data-line-number="75"></td>
        <td id="file-timelapse_app-py-LC75" class="blob-code blob-code-inner js-file-line"><span class="pl-en">@app.route</span>(<span class="pl-s"><span class="pl-pds">'</span>/system<span class="pl-pds">'</span></span>, <span class="pl-v">methods</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L76" class="blob-num js-line-number" data-line-number="76"></td>
        <td id="file-timelapse_app-py-LC76" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">system</span>():</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L77" class="blob-num js-line-number" data-line-number="77"></td>
        <td id="file-timelapse_app-py-LC77" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> genericresponse()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L78" class="blob-num js-line-number" data-line-number="78"></td>
        <td id="file-timelapse_app-py-LC78" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L79" class="blob-num js-line-number" data-line-number="79"></td>
        <td id="file-timelapse_app-py-LC79" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span>redirect lastimage to address with v.lastimage filename</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L80" class="blob-num js-line-number" data-line-number="80"></td>
        <td id="file-timelapse_app-py-LC80" class="blob-code blob-code-inner js-file-line"><span class="pl-en">@app.route</span>(<span class="pl-s"><span class="pl-pds">'</span>/lastimage<span class="pl-pds">'</span></span>, <span class="pl-v">methods</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L81" class="blob-num js-line-number" data-line-number="81"></td>
        <td id="file-timelapse_app-py-LC81" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">lastimage</span>():</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L82" class="blob-num js-line-number" data-line-number="82"></td>
        <td id="file-timelapse_app-py-LC82" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> v.lastimage:</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L83" class="blob-num js-line-number" data-line-number="83"></td>
        <td id="file-timelapse_app-py-LC83" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> redirect(<span class="pl-s"><span class="pl-pds">'</span>/lastimage/<span class="pl-pds">'</span></span> <span class="pl-k">+</span> v.lastimage)</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L84" class="blob-num js-line-number" data-line-number="84"></td>
        <td id="file-timelapse_app-py-LC84" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L85" class="blob-num js-line-number" data-line-number="85"></td>
        <td id="file-timelapse_app-py-LC85" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>no last image<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;BR&gt;<span class="pl-pds">'</span></span> <span class="pl-k">+</span> genericresponse()</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L86" class="blob-num js-line-number" data-line-number="86"></td>
        <td id="file-timelapse_app-py-LC86" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L87" class="blob-num js-line-number" data-line-number="87"></td>
        <td id="file-timelapse_app-py-LC87" class="blob-code blob-code-inner js-file-line"><span class="pl-en">@app.route</span>(<span class="pl-s"><span class="pl-pds">'</span>/lastimage/&lt;filename&gt;<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L88" class="blob-num js-line-number" data-line-number="88"></td>
        <td id="file-timelapse_app-py-LC88" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">send_lastimage</span>(<span class="pl-smi">filename</span>):</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L89" class="blob-num js-line-number" data-line-number="89"></td>
        <td id="file-timelapse_app-py-LC89" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> <span class="pl-s"><span class="pl-pds">'</span>..<span class="pl-pds">'</span></span> <span class="pl-k">in</span> filename <span class="pl-k">or</span> filename.startswith(<span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>):</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L90" class="blob-num js-line-number" data-line-number="90"></td>
        <td id="file-timelapse_app-py-LC90" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>please don<span class="pl-cce">\'</span>t be nasty<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L91" class="blob-num js-line-number" data-line-number="91"></td>
        <td id="file-timelapse_app-py-LC91" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L92" class="blob-num js-line-number" data-line-number="92"></td>
        <td id="file-timelapse_app-py-LC92" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> send_file(v.savepath <span class="pl-k">+</span> filename)</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L93" class="blob-num js-line-number" data-line-number="93"></td>
        <td id="file-timelapse_app-py-LC93" class="blob-code blob-code-inner js-file-line">        </td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L94" class="blob-num js-line-number" data-line-number="94"></td>
        <td id="file-timelapse_app-py-LC94" class="blob-code blob-code-inner js-file-line"><span class="pl-en">@app.route</span>(<span class="pl-s"><span class="pl-pds">'</span>/help<span class="pl-pds">'</span></span>, <span class="pl-v">methods</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L95" class="blob-num js-line-number" data-line-number="95"></td>
        <td id="file-timelapse_app-py-LC95" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-c1">help</span>():</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L96" class="blob-num js-line-number" data-line-number="96"></td>
        <td id="file-timelapse_app-py-LC96" class="blob-code blob-code-inner js-file-line">    ret <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>startarm<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;BR&gt;<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L97" class="blob-num js-line-number" data-line-number="97"></td>
        <td id="file-timelapse_app-py-LC97" class="blob-code blob-code-inner js-file-line">    ret <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">'</span>stoparm<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;BR&gt;<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L98" class="blob-num js-line-number" data-line-number="98"></td>
        <td id="file-timelapse_app-py-LC98" class="blob-code blob-code-inner js-file-line">    ret <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">'</span>startvideo<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;BR&gt;<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L99" class="blob-num js-line-number" data-line-number="99"></td>
        <td id="file-timelapse_app-py-LC99" class="blob-code blob-code-inner js-file-line">    ret <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">'</span>stopvideo<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;BR&gt;<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L100" class="blob-num js-line-number" data-line-number="100"></td>
        <td id="file-timelapse_app-py-LC100" class="blob-code blob-code-inner js-file-line">    ret <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">'</span>timelapseon<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;BR&gt;<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L101" class="blob-num js-line-number" data-line-number="101"></td>
        <td id="file-timelapse_app-py-LC101" class="blob-code blob-code-inner js-file-line">    ret <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">'</span>timelapseoff<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;BR&gt;<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L102" class="blob-num js-line-number" data-line-number="102"></td>
        <td id="file-timelapse_app-py-LC102" class="blob-code blob-code-inner js-file-line">    ret <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">'</span>lastimage<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;BR&gt;<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L103" class="blob-num js-line-number" data-line-number="103"></td>
        <td id="file-timelapse_app-py-LC103" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> ret</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L104" class="blob-num js-line-number" data-line-number="104"></td>
        <td id="file-timelapse_app-py-LC104" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L105" class="blob-num js-line-number" data-line-number="105"></td>
        <td id="file-timelapse_app-py-LC105" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span>home page</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L106" class="blob-num js-line-number" data-line-number="106"></td>
        <td id="file-timelapse_app-py-LC106" class="blob-code blob-code-inner js-file-line"><span class="pl-en">@app.route</span>(<span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>, <span class="pl-v">methods</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L107" class="blob-num js-line-number" data-line-number="107"></td>
        <td id="file-timelapse_app-py-LC107" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">get_index</span>():</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L108" class="blob-num js-line-number" data-line-number="108"></td>
        <td id="file-timelapse_app-py-LC108" class="blob-code blob-code-inner js-file-line">    ret <span class="pl-k">=</span> pprint.pformat(v.<span class="pl-c1">__dict__</span>)</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L109" class="blob-num js-line-number" data-line-number="109"></td>
        <td id="file-timelapse_app-py-LC109" class="blob-code blob-code-inner js-file-line">    ret <span class="pl-k">=</span> ret.replace(<span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>&lt;BR&gt;<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L110" class="blob-num js-line-number" data-line-number="110"></td>
        <td id="file-timelapse_app-py-LC110" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> ret</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L111" class="blob-num js-line-number" data-line-number="111"></td>
        <td id="file-timelapse_app-py-LC111" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L112" class="blob-num js-line-number" data-line-number="112"></td>
        <td id="file-timelapse_app-py-LC112" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span>start the app/webserver</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L113" class="blob-num js-line-number" data-line-number="113"></td>
        <td id="file-timelapse_app-py-LC113" class="blob-code blob-code-inner js-file-line"><span class="pl-k">if</span> <span class="pl-c1">__name__</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">"</span>__main__<span class="pl-pds">"</span></span>:</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L114" class="blob-num js-line-number" data-line-number="114"></td>
        <td id="file-timelapse_app-py-LC114" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">try</span>:        </td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L115" class="blob-num js-line-number" data-line-number="115"></td>
        <td id="file-timelapse_app-py-LC115" class="blob-code blob-code-inner js-file-line">        app.run(<span class="pl-v">host</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>0.0.0.0<span class="pl-pds">'</span></span>, <span class="pl-v">port</span><span class="pl-k">=</span><span class="pl-c1">5010</span>, <span class="pl-v">debug</span><span class="pl-k">=</span><span class="pl-c1">True</span>)</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L116" class="blob-num js-line-number" data-line-number="116"></td>
        <td id="file-timelapse_app-py-LC116" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span>socketio.run(app, host='0.0.0.0', use_reloader=True)</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L117" class="blob-num js-line-number" data-line-number="117"></td>
        <td id="file-timelapse_app-py-LC117" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span>socketio.run(app, host='0.0.0.0', port=5001, use_reloader=True)</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L118" class="blob-num js-line-number" data-line-number="118"></td>
        <td id="file-timelapse_app-py-LC118" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">except</span>:</td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L119" class="blob-num js-line-number" data-line-number="119"></td>
        <td id="file-timelapse_app-py-LC119" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>EXITING AND AT LAST LINE<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L120" class="blob-num js-line-number" data-line-number="120"></td>
        <td id="file-timelapse_app-py-LC120" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">raise</span></td>
      </tr>
      <tr>
        <td id="file-timelapse_app-py-L121" class="blob-num js-line-number" data-line-number="121"></td>
        <td id="file-timelapse_app-py-LC121" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/cudmore/c4ab92d288cfd1778be5/raw/445e2d13411641f5559b08fe9b8e9e1ad336a7cc/timelapse_app.py" style="float:right">view raw</a>
        <a href="https://gist.github.com/cudmore/c4ab92d288cfd1778be5#file-timelapse_app-py">timelapse_app.py</a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-videoserver-py" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-python">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-videoserver-py-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-videoserver-py-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span>Author: Robert H Cudmore</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-videoserver-py-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span>Web: http://robertcudmore.org</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-videoserver-py-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span>Date: 20151205</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-videoserver-py-LC4" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span>Purpose: A rewrite of VideoThread.py</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-videoserver-py-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-videoserver-py-LC6" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span>This should not use pins but respond to function calls instead</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-videoserver-py-LC7" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-videoserver-py-LC8" class="blob-code blob-code-inner js-file-line"><span class="pl-s"><span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-videoserver-py-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-s">Usage</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-videoserver-py-LC10" class="blob-code blob-code-inner js-file-line"><span class="pl-s">==========</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-videoserver-py-LC11" class="blob-code blob-code-inner js-file-line"><span class="pl-s">import VideoServer</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-videoserver-py-LC12" class="blob-code blob-code-inner js-file-line"><span class="pl-s">v=VideoServer.VideoServer()</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-videoserver-py-LC13" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-videoserver-py-LC14" class="blob-code blob-code-inner js-file-line"><span class="pl-s">#start video server daemon</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-videoserver-py-LC15" class="blob-code blob-code-inner js-file-line"><span class="pl-s">v.daemon = True</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-videoserver-py-LC16" class="blob-code blob-code-inner js-file-line"><span class="pl-s">v.start()</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-videoserver-py-LC17" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-videoserver-py-LC18" class="blob-code blob-code-inner js-file-line"><span class="pl-s">v.startArm()</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-videoserver-py-LC19" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-videoserver-py-LC20" class="blob-code blob-code-inner js-file-line"><span class="pl-s">#start and stop video recording as much as you like</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-videoserver-py-LC21" class="blob-code blob-code-inner js-file-line"><span class="pl-s">v.startVideo()</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-videoserver-py-LC22" class="blob-code blob-code-inner js-file-line"><span class="pl-s">v.stopVideo()</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-videoserver-py-LC23" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-videoserver-py-LC24" class="blob-code blob-code-inner js-file-line"><span class="pl-s">v.startVideo()</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-videoserver-py-LC25" class="blob-code blob-code-inner js-file-line"><span class="pl-s">v.stopVideo()</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-videoserver-py-LC26" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-videoserver-py-LC27" class="blob-code blob-code-inner js-file-line"><span class="pl-s">v.doTimelapse=1</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-videoserver-py-LC28" class="blob-code blob-code-inner js-file-line"><span class="pl-s">v.doTimelapse=0</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-videoserver-py-LC29" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-videoserver-py-LC30" class="blob-code blob-code-inner js-file-line"><span class="pl-s">v.stopArm()</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-videoserver-py-LC31" class="blob-code blob-code-inner js-file-line"><span class="pl-s"><span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-videoserver-py-LC32" class="blob-code blob-code-inner js-file-line"><span class="pl-k">import</span> os, time, io, math, threading</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-videoserver-py-LC33" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> datetime <span class="pl-k">import</span> datetime <span class="pl-c"><span class="pl-c">#</span>to get fractional seconds</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-videoserver-py-LC34" class="blob-code blob-code-inner js-file-line"><span class="pl-k">import</span> picamera</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-videoserver-py-LC35" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-videoserver-py-LC36" class="blob-code blob-code-inner js-file-line"><span class="pl-k">class</span> <span class="pl-en">VideoServer</span>(<span class="pl-e">threading</span>.<span class="pl-e">Thread</span>):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-videoserver-py-LC37" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-c1">__init__</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-videoserver-py-LC38" class="blob-code blob-code-inner js-file-line">        threading.Thread.<span class="pl-c1">__init__</span>(<span class="pl-c1">self</span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-videoserver-py-LC39" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-videoserver-py-LC40" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span>when this script is running, it will always be armed</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-videoserver-py-LC41" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.isArmed <span class="pl-k">=</span> <span class="pl-c1">0</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-videoserver-py-LC42" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.videoStarted <span class="pl-k">=</span> <span class="pl-c1">0</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-videoserver-py-LC43" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-videoserver-py-LC44" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.stream <span class="pl-k">=</span> <span class="pl-c1">None</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-videoserver-py-LC45" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-videoserver-py-LC46" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.savepath <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>/home/pi/video/<span class="pl-pds">'</span></span> <span class="pl-k">+</span> time.strftime(<span class="pl-s"><span class="pl-pds">'</span>%Y%m<span class="pl-c1">%d</span><span class="pl-pds">'</span></span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-videoserver-py-LC47" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-k">not</span> os.path.exists(<span class="pl-c1">self</span>.savepath):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-videoserver-py-LC48" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span>VideoServer is making output directory:<span class="pl-pds">'</span></span>, <span class="pl-c1">self</span>.savepath</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-videoserver-py-LC49" class="blob-code blob-code-inner js-file-line">            os.makedirs(<span class="pl-c1">self</span>.savepath)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-videoserver-py-LC50" class="blob-code blob-code-inner js-file-line">        </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-videoserver-py-LC51" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.savename <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span> <span class="pl-c"><span class="pl-c">#</span> the prefix to save all files</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L52" class="blob-num js-line-number" data-line-number="52"></td>
        <td id="file-videoserver-py-LC52" class="blob-code blob-code-inner js-file-line">        </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L53" class="blob-num js-line-number" data-line-number="53"></td>
        <td id="file-videoserver-py-LC53" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.logFileName <span class="pl-k">=</span> <span class="pl-c1">None</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L54" class="blob-num js-line-number" data-line-number="54"></td>
        <td id="file-videoserver-py-LC54" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.logFilePath <span class="pl-k">=</span> <span class="pl-c1">None</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L55" class="blob-num js-line-number" data-line-number="55"></td>
        <td id="file-videoserver-py-LC55" class="blob-code blob-code-inner js-file-line"> </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L56" class="blob-num js-line-number" data-line-number="56"></td>
        <td id="file-videoserver-py-LC56" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.beforefilename <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L57" class="blob-num js-line-number" data-line-number="57"></td>
        <td id="file-videoserver-py-LC57" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.afterfilename <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L58" class="blob-num js-line-number" data-line-number="58"></td>
        <td id="file-videoserver-py-LC58" class="blob-code blob-code-inner js-file-line">        </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L59" class="blob-num js-line-number" data-line-number="59"></td>
        <td id="file-videoserver-py-LC59" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.beforefilepath <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L60" class="blob-num js-line-number" data-line-number="60"></td>
        <td id="file-videoserver-py-LC60" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.afterfilepath <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L61" class="blob-num js-line-number" data-line-number="61"></td>
        <td id="file-videoserver-py-LC61" class="blob-code blob-code-inner js-file-line">        </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L62" class="blob-num js-line-number" data-line-number="62"></td>
        <td id="file-videoserver-py-LC62" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.bufferSeconds <span class="pl-k">=</span> <span class="pl-c1">5</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L63" class="blob-num js-line-number" data-line-number="63"></td>
        <td id="file-videoserver-py-LC63" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L64" class="blob-num js-line-number" data-line-number="64"></td>
        <td id="file-videoserver-py-LC64" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.startTime <span class="pl-k">=</span> <span class="pl-c1">0</span> <span class="pl-c"><span class="pl-c">#</span>when we start recording in run(), triggered by startVideo()</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L65" class="blob-num js-line-number" data-line-number="65"></td>
        <td id="file-videoserver-py-LC65" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.recordDuration <span class="pl-k">=</span> <span class="pl-c1">10</span> <span class="pl-c"><span class="pl-c">#</span>seconds, set to infinity to then stop with stopVideo()</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L66" class="blob-num js-line-number" data-line-number="66"></td>
        <td id="file-videoserver-py-LC66" class="blob-code blob-code-inner js-file-line">        </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L67" class="blob-num js-line-number" data-line-number="67"></td>
        <td id="file-videoserver-py-LC67" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.doTimelapse <span class="pl-k">=</span> <span class="pl-c1">0</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L68" class="blob-num js-line-number" data-line-number="68"></td>
        <td id="file-videoserver-py-LC68" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.stillinterval <span class="pl-k">=</span> <span class="pl-c1">5</span> <span class="pl-c"><span class="pl-c">#</span>second</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L69" class="blob-num js-line-number" data-line-number="69"></td>
        <td id="file-videoserver-py-LC69" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.lastimage <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L70" class="blob-num js-line-number" data-line-number="70"></td>
        <td id="file-videoserver-py-LC70" class="blob-code blob-code-inner js-file-line">        </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L71" class="blob-num js-line-number" data-line-number="71"></td>
        <td id="file-videoserver-py-LC71" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">getState</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L72" class="blob-num js-line-number" data-line-number="72"></td>
        <td id="file-videoserver-py-LC72" class="blob-code blob-code-inner js-file-line">        ret <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>a=b<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L73" class="blob-num js-line-number" data-line-number="73"></td>
        <td id="file-videoserver-py-LC73" class="blob-code blob-code-inner js-file-line">        ret <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span>c=d<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L74" class="blob-num js-line-number" data-line-number="74"></td>
        <td id="file-videoserver-py-LC74" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> ret</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L75" class="blob-num js-line-number" data-line-number="75"></td>
        <td id="file-videoserver-py-LC75" class="blob-code blob-code-inner js-file-line">        </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L76" class="blob-num js-line-number" data-line-number="76"></td>
        <td id="file-videoserver-py-LC76" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">startArm</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L77" class="blob-num js-line-number" data-line-number="77"></td>
        <td id="file-videoserver-py-LC77" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span>VideoThread startArm()<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L78" class="blob-num js-line-number" data-line-number="78"></td>
        <td id="file-videoserver-py-LC78" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-c1">self</span>.isArmed <span class="pl-k">==</span> <span class="pl-c1">0</span>:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L79" class="blob-num js-line-number" data-line-number="79"></td>
        <td id="file-videoserver-py-LC79" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span>VideoServer initializing camera<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L80" class="blob-num js-line-number" data-line-number="80"></td>
        <td id="file-videoserver-py-LC80" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.camera <span class="pl-k">=</span> picamera.PiCamera()</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L81" class="blob-num js-line-number" data-line-number="81"></td>
        <td id="file-videoserver-py-LC81" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.camera.resolution <span class="pl-k">=</span> (<span class="pl-c1">640</span>, <span class="pl-c1">480</span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L82" class="blob-num js-line-number" data-line-number="82"></td>
        <td id="file-videoserver-py-LC82" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"><span class="pl-c">#</span>self.camera.led = 0</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L83" class="blob-num js-line-number" data-line-number="83"></td>
        <td id="file-videoserver-py-LC83" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.camera.start_preview()</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L84" class="blob-num js-line-number" data-line-number="84"></td>
        <td id="file-videoserver-py-LC84" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.camera.framerate <span class="pl-k">=</span> <span class="pl-c1">30</span> <span class="pl-c"><span class="pl-c">#</span> can be 60</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L85" class="blob-num js-line-number" data-line-number="85"></td>
        <td id="file-videoserver-py-LC85" class="blob-code blob-code-inner js-file-line">            </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L86" class="blob-num js-line-number" data-line-number="86"></td>
        <td id="file-videoserver-py-LC86" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span>VideoServer starting circular stream<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L87" class="blob-num js-line-number" data-line-number="87"></td>
        <td id="file-videoserver-py-LC87" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.stream <span class="pl-k">=</span> picamera.PiCameraCircularIO(<span class="pl-c1">self</span>.camera, <span class="pl-v">seconds</span><span class="pl-k">=</span><span class="pl-c1">self</span>.bufferSeconds)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L88" class="blob-num js-line-number" data-line-number="88"></td>
        <td id="file-videoserver-py-LC88" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.camera.start_recording(<span class="pl-c1">self</span>.stream, <span class="pl-v">format</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>h264<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L89" class="blob-num js-line-number" data-line-number="89"></td>
        <td id="file-videoserver-py-LC89" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L90" class="blob-num js-line-number" data-line-number="90"></td>
        <td id="file-videoserver-py-LC90" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.isArmed <span class="pl-k">=</span> <span class="pl-c1">1</span> <span class="pl-c"><span class="pl-c">#</span>order is important, must come after we instantiate camera</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L91" class="blob-num js-line-number" data-line-number="91"></td>
        <td id="file-videoserver-py-LC91" class="blob-code blob-code-inner js-file-line">        </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L92" class="blob-num js-line-number" data-line-number="92"></td>
        <td id="file-videoserver-py-LC92" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">stopArm</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L93" class="blob-num js-line-number" data-line-number="93"></td>
        <td id="file-videoserver-py-LC93" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span>VideoThread stopArm()<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L94" class="blob-num js-line-number" data-line-number="94"></td>
        <td id="file-videoserver-py-LC94" class="blob-code blob-code-inner js-file-line">        timestamp <span class="pl-k">=</span> <span class="pl-c1">self</span>.GetTimestamp()</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L95" class="blob-num js-line-number" data-line-number="95"></td>
        <td id="file-videoserver-py-LC95" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-c1">self</span>.isArmed <span class="pl-k">==</span> <span class="pl-c1">1</span>:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L96" class="blob-num js-line-number" data-line-number="96"></td>
        <td id="file-videoserver-py-LC96" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.isArmed <span class="pl-k">=</span> <span class="pl-c1">0</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L97" class="blob-num js-line-number" data-line-number="97"></td>
        <td id="file-videoserver-py-LC97" class="blob-code blob-code-inner js-file-line">            </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L98" class="blob-num js-line-number" data-line-number="98"></td>
        <td id="file-videoserver-py-LC98" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.camera.stop_preview()</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L99" class="blob-num js-line-number" data-line-number="99"></td>
        <td id="file-videoserver-py-LC99" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.camera.close()</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L100" class="blob-num js-line-number" data-line-number="100"></td>
        <td id="file-videoserver-py-LC100" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.camera <span class="pl-k">=</span> <span class="pl-c1">None</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L101" class="blob-num js-line-number" data-line-number="101"></td>
        <td id="file-videoserver-py-LC101" class="blob-code blob-code-inner js-file-line">            </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L102" class="blob-num js-line-number" data-line-number="102"></td>
        <td id="file-videoserver-py-LC102" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.logfileWrite(timestamp, <span class="pl-s"><span class="pl-pds">'</span>VideoServerStopArm<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L103" class="blob-num js-line-number" data-line-number="103"></td>
        <td id="file-videoserver-py-LC103" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.logFileName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L104" class="blob-num js-line-number" data-line-number="104"></td>
        <td id="file-videoserver-py-LC104" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.scanImageFrame <span class="pl-k">=</span> <span class="pl-c1">0</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L105" class="blob-num js-line-number" data-line-number="105"></td>
        <td id="file-videoserver-py-LC105" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span>VideoServer stopArm() is done<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L106" class="blob-num js-line-number" data-line-number="106"></td>
        <td id="file-videoserver-py-LC106" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L107" class="blob-num js-line-number" data-line-number="107"></td>
        <td id="file-videoserver-py-LC107" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">startVideo</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L108" class="blob-num js-line-number" data-line-number="108"></td>
        <td id="file-videoserver-py-LC108" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L109" class="blob-num js-line-number" data-line-number="109"></td>
        <td id="file-videoserver-py-LC109" class="blob-code blob-code-inner js-file-line"><span class="pl-s">        todo: add parameter for recordDuration</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L110" class="blob-num js-line-number" data-line-number="110"></td>
        <td id="file-videoserver-py-LC110" class="blob-code blob-code-inner js-file-line"><span class="pl-s">        <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L111" class="blob-num js-line-number" data-line-number="111"></td>
        <td id="file-videoserver-py-LC111" class="blob-code blob-code-inner js-file-line">        timestamp <span class="pl-k">=</span> <span class="pl-c1">self</span>.GetTimestamp2()</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L112" class="blob-num js-line-number" data-line-number="112"></td>
        <td id="file-videoserver-py-LC112" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-c1">self</span>.isArmed <span class="pl-k">and</span> <span class="pl-k">not</span> <span class="pl-c1">self</span>.videoStarted:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L113" class="blob-num js-line-number" data-line-number="113"></td>
        <td id="file-videoserver-py-LC113" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.recordDuration <span class="pl-k">=</span> <span class="pl-c1">5</span> <span class="pl-c"><span class="pl-c">#</span>seconds, make this a parameter</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L114" class="blob-num js-line-number" data-line-number="114"></td>
        <td id="file-videoserver-py-LC114" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.savename <span class="pl-k">=</span> timestamp.split(<span class="pl-s"><span class="pl-pds">'</span>.<span class="pl-pds">'</span></span>)[<span class="pl-c1">0</span>]</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L115" class="blob-num js-line-number" data-line-number="115"></td>
        <td id="file-videoserver-py-LC115" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.scanImageFrame <span class="pl-k">=</span> <span class="pl-c1">0</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L116" class="blob-num js-line-number" data-line-number="116"></td>
        <td id="file-videoserver-py-LC116" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.videoStarted <span class="pl-k">=</span> <span class="pl-c1">1</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L117" class="blob-num js-line-number" data-line-number="117"></td>
        <td id="file-videoserver-py-LC117" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.logfileWrite(timestamp, <span class="pl-s"><span class="pl-pds">'</span>VideoStart<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L118" class="blob-num js-line-number" data-line-number="118"></td>
        <td id="file-videoserver-py-LC118" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span> <span class="pl-c1">self</span>.camera:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L119" class="blob-num js-line-number" data-line-number="119"></td>
        <td id="file-videoserver-py-LC119" class="blob-code blob-code-inner js-file-line">                <span class="pl-c1">self</span>.camera.annotate_text <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>S<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L120" class="blob-num js-line-number" data-line-number="120"></td>
        <td id="file-videoserver-py-LC120" class="blob-code blob-code-inner js-file-line">                <span class="pl-c1">self</span>.camera.annotate_background <span class="pl-k">=</span> picamera.Color(<span class="pl-s"><span class="pl-pds">'</span>black<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L121" class="blob-num js-line-number" data-line-number="121"></td>
        <td id="file-videoserver-py-LC121" class="blob-code blob-code-inner js-file-line">            </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L122" class="blob-num js-line-number" data-line-number="122"></td>
        <td id="file-videoserver-py-LC122" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"><span class="pl-c">#</span>remove fractional seconds</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L123" class="blob-num js-line-number" data-line-number="123"></td>
        <td id="file-videoserver-py-LC123" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.logFileName <span class="pl-k">=</span> <span class="pl-c1">self</span>.savename <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>_si.txt<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L124" class="blob-num js-line-number" data-line-number="124"></td>
        <td id="file-videoserver-py-LC124" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.logFilePath <span class="pl-k">=</span> <span class="pl-c1">self</span>.savepath <span class="pl-k">+</span> <span class="pl-c1">self</span>.logFileName</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L125" class="blob-num js-line-number" data-line-number="125"></td>
        <td id="file-videoserver-py-LC125" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.logfileWrite(timestamp, <span class="pl-s"><span class="pl-pds">'</span>startVideo<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L126" class="blob-num js-line-number" data-line-number="126"></td>
        <td id="file-videoserver-py-LC126" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L127" class="blob-num js-line-number" data-line-number="127"></td>
        <td id="file-videoserver-py-LC127" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">stopVideo</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L128" class="blob-num js-line-number" data-line-number="128"></td>
        <td id="file-videoserver-py-LC128" class="blob-code blob-code-inner js-file-line">        timestamp <span class="pl-k">=</span> <span class="pl-c1">self</span>.GetTimestamp2()</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L129" class="blob-num js-line-number" data-line-number="129"></td>
        <td id="file-videoserver-py-LC129" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-c1">self</span>.isArmed <span class="pl-k">and</span> <span class="pl-c1">self</span>.videoStarted:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L130" class="blob-num js-line-number" data-line-number="130"></td>
        <td id="file-videoserver-py-LC130" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.videoStarted <span class="pl-k">=</span> <span class="pl-c1">0</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L131" class="blob-num js-line-number" data-line-number="131"></td>
        <td id="file-videoserver-py-LC131" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span> <span class="pl-c1">self</span>.camera:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L132" class="blob-num js-line-number" data-line-number="132"></td>
        <td id="file-videoserver-py-LC132" class="blob-code blob-code-inner js-file-line">                <span class="pl-c1">self</span>.camera.annotate_text <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L133" class="blob-num js-line-number" data-line-number="133"></td>
        <td id="file-videoserver-py-LC133" class="blob-code blob-code-inner js-file-line">                <span class="pl-c1">self</span>.camera.annotate_background <span class="pl-k">=</span> <span class="pl-c1">None</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L134" class="blob-num js-line-number" data-line-number="134"></td>
        <td id="file-videoserver-py-LC134" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.logfileWrite(timestamp, <span class="pl-s"><span class="pl-pds">'</span>stopVideo<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L135" class="blob-num js-line-number" data-line-number="135"></td>
        <td id="file-videoserver-py-LC135" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.logFileName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L136" class="blob-num js-line-number" data-line-number="136"></td>
        <td id="file-videoserver-py-LC136" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.logFilePath <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L137" class="blob-num js-line-number" data-line-number="137"></td>
        <td id="file-videoserver-py-LC137" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L138" class="blob-num js-line-number" data-line-number="138"></td>
        <td id="file-videoserver-py-LC138" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">logfileWrite</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">timestamp</span>, <span class="pl-smi">myStr</span>):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L139" class="blob-num js-line-number" data-line-number="139"></td>
        <td id="file-videoserver-py-LC139" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-c1">self</span>.logFilePath:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L140" class="blob-num js-line-number" data-line-number="140"></td>
        <td id="file-videoserver-py-LC140" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">with</span> <span class="pl-c1">open</span>(<span class="pl-c1">self</span>.logFilePath, <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> textfile:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L141" class="blob-num js-line-number" data-line-number="141"></td>
        <td id="file-videoserver-py-LC141" class="blob-code blob-code-inner js-file-line">                textfile.write(<span class="pl-c1">str</span>(timestamp) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span><span class="pl-pds">'</span></span> <span class="pl-k">+</span> myStr <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span><span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L142" class="blob-num js-line-number" data-line-number="142"></td>
        <td id="file-videoserver-py-LC142" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L143" class="blob-num js-line-number" data-line-number="143"></td>
        <td id="file-videoserver-py-LC143" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">GetTimestamp</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L144" class="blob-num js-line-number" data-line-number="144"></td>
        <td id="file-videoserver-py-LC144" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span>returns integer seconds (for file names)</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L145" class="blob-num js-line-number" data-line-number="145"></td>
        <td id="file-videoserver-py-LC145" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> time.strftime(<span class="pl-s"><span class="pl-pds">'</span>%Y%m<span class="pl-c1">%d</span><span class="pl-pds">'</span></span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>_<span class="pl-pds">'</span></span> <span class="pl-k">+</span> time.strftime(<span class="pl-s"><span class="pl-pds">'</span>%H%M%S<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L146" class="blob-num js-line-number" data-line-number="146"></td>
        <td id="file-videoserver-py-LC146" class="blob-code blob-code-inner js-file-line">    </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L147" class="blob-num js-line-number" data-line-number="147"></td>
        <td id="file-videoserver-py-LC147" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">GetTimestamp2</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L148" class="blob-num js-line-number" data-line-number="148"></td>
        <td id="file-videoserver-py-LC148" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> returns fraction seconds (for log file entries)</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L149" class="blob-num js-line-number" data-line-number="149"></td>
        <td id="file-videoserver-py-LC149" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span>datetime.datetime.now().strftime("%H:%M:%S.%f")</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L150" class="blob-num js-line-number" data-line-number="150"></td>
        <td id="file-videoserver-py-LC150" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> time.strftime(<span class="pl-s"><span class="pl-pds">'</span>%Y%m<span class="pl-c1">%d</span><span class="pl-pds">'</span></span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>_<span class="pl-pds">'</span></span> <span class="pl-k">+</span> datetime.now().strftime(<span class="pl-s"><span class="pl-pds">"</span>%H%M%S.<span class="pl-c1">%f</span><span class="pl-pds">"</span></span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L151" class="blob-num js-line-number" data-line-number="151"></td>
        <td id="file-videoserver-py-LC151" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L152" class="blob-num js-line-number" data-line-number="152"></td>
        <td id="file-videoserver-py-LC152" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span>called from run()</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L153" class="blob-num js-line-number" data-line-number="153"></td>
        <td id="file-videoserver-py-LC153" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">write_video</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">stream</span>, <span class="pl-smi">beforeFilePath</span>):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L154" class="blob-num js-line-number" data-line-number="154"></td>
        <td id="file-videoserver-py-LC154" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> Write the entire content of the circular buffer to disk. No need to</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L155" class="blob-num js-line-number" data-line-number="155"></td>
        <td id="file-videoserver-py-LC155" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> lock the stream here as we're definitely not writing to it</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L156" class="blob-num js-line-number" data-line-number="156"></td>
        <td id="file-videoserver-py-LC156" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> simultaneously</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L157" class="blob-num js-line-number" data-line-number="157"></td>
        <td id="file-videoserver-py-LC157" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span>with io.open(self.savepath + 'before.h264', 'wb') as output:</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L158" class="blob-num js-line-number" data-line-number="158"></td>
        <td id="file-videoserver-py-LC158" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">with</span> io.open(beforeFilePath, <span class="pl-s"><span class="pl-pds">'</span>wb<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> output:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L159" class="blob-num js-line-number" data-line-number="159"></td>
        <td id="file-videoserver-py-LC159" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">for</span> frame <span class="pl-k">in</span> stream.frames:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L160" class="blob-num js-line-number" data-line-number="160"></td>
        <td id="file-videoserver-py-LC160" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">if</span> frame.frame_type <span class="pl-k">==</span> picamera.PiVideoFrameType.sps_header:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L161" class="blob-num js-line-number" data-line-number="161"></td>
        <td id="file-videoserver-py-LC161" class="blob-code blob-code-inner js-file-line">                    stream.seek(frame.position)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L162" class="blob-num js-line-number" data-line-number="162"></td>
        <td id="file-videoserver-py-LC162" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">break</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L163" class="blob-num js-line-number" data-line-number="163"></td>
        <td id="file-videoserver-py-LC163" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">while</span> <span class="pl-c1">True</span>:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L164" class="blob-num js-line-number" data-line-number="164"></td>
        <td id="file-videoserver-py-LC164" class="blob-code blob-code-inner js-file-line">                buf <span class="pl-k">=</span> stream.read1()</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L165" class="blob-num js-line-number" data-line-number="165"></td>
        <td id="file-videoserver-py-LC165" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">if</span> <span class="pl-k">not</span> buf:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L166" class="blob-num js-line-number" data-line-number="166"></td>
        <td id="file-videoserver-py-LC166" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">break</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L167" class="blob-num js-line-number" data-line-number="167"></td>
        <td id="file-videoserver-py-LC167" class="blob-code blob-code-inner js-file-line">                output.write(buf)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L168" class="blob-num js-line-number" data-line-number="168"></td>
        <td id="file-videoserver-py-LC168" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> Wipe the circular stream once we're done</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L169" class="blob-num js-line-number" data-line-number="169"></td>
        <td id="file-videoserver-py-LC169" class="blob-code blob-code-inner js-file-line">        stream.seek(<span class="pl-c1">0</span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L170" class="blob-num js-line-number" data-line-number="170"></td>
        <td id="file-videoserver-py-LC170" class="blob-code blob-code-inner js-file-line">        stream.truncate()</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L171" class="blob-num js-line-number" data-line-number="171"></td>
        <td id="file-videoserver-py-LC171" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L172" class="blob-num js-line-number" data-line-number="172"></td>
        <td id="file-videoserver-py-LC172" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span>start arm</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L173" class="blob-num js-line-number" data-line-number="173"></td>
        <td id="file-videoserver-py-LC173" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">run</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L174" class="blob-num js-line-number" data-line-number="174"></td>
        <td id="file-videoserver-py-LC174" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span>VideoServer run() is initializing [can only call this once]<span class="pl-pds">'</span></span> </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L175" class="blob-num js-line-number" data-line-number="175"></td>
        <td id="file-videoserver-py-LC175" class="blob-code blob-code-inner js-file-line">        lasttime <span class="pl-k">=</span> time.time()</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L176" class="blob-num js-line-number" data-line-number="176"></td>
        <td id="file-videoserver-py-LC176" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">while</span> <span class="pl-c1">True</span>:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L177" class="blob-num js-line-number" data-line-number="177"></td>
        <td id="file-videoserver-py-LC177" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span> <span class="pl-c1">self</span>.isArmed:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L178" class="blob-num js-line-number" data-line-number="178"></td>
        <td id="file-videoserver-py-LC178" class="blob-code blob-code-inner js-file-line">                timestamp <span class="pl-k">=</span> <span class="pl-c1">self</span>.GetTimestamp()</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L179" class="blob-num js-line-number" data-line-number="179"></td>
        <td id="file-videoserver-py-LC179" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">while</span> (<span class="pl-c1">self</span>.isArmed):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L180" class="blob-num js-line-number" data-line-number="180"></td>
        <td id="file-videoserver-py-LC180" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">try</span>:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L181" class="blob-num js-line-number" data-line-number="181"></td>
        <td id="file-videoserver-py-LC181" class="blob-code blob-code-inner js-file-line">                        <span class="pl-c1">self</span>.camera.wait_recording(<span class="pl-c1">0.005</span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L182" class="blob-num js-line-number" data-line-number="182"></td>
        <td id="file-videoserver-py-LC182" class="blob-code blob-code-inner js-file-line">                        <span class="pl-k">if</span> <span class="pl-c1">self</span>.videoStarted:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L183" class="blob-num js-line-number" data-line-number="183"></td>
        <td id="file-videoserver-py-LC183" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">self</span>.startTime <span class="pl-k">=</span> time.time() <span class="pl-c"><span class="pl-c">#</span>seconds, linux epoch</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L184" class="blob-num js-line-number" data-line-number="184"></td>
        <td id="file-videoserver-py-LC184" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">self</span>.beforefilename <span class="pl-k">=</span> <span class="pl-c1">self</span>.savename <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>_before<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>.h264<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L185" class="blob-num js-line-number" data-line-number="185"></td>
        <td id="file-videoserver-py-LC185" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">self</span>.afterfilename <span class="pl-k">=</span> <span class="pl-c1">self</span>.savename <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>_after<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>.h264<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L186" class="blob-num js-line-number" data-line-number="186"></td>
        <td id="file-videoserver-py-LC186" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">self</span>.beforefilepath <span class="pl-k">=</span> <span class="pl-c1">self</span>.savepath <span class="pl-k">+</span> <span class="pl-c1">self</span>.beforefilename</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L187" class="blob-num js-line-number" data-line-number="187"></td>
        <td id="file-videoserver-py-LC187" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">self</span>.afterfilepath <span class="pl-k">=</span> <span class="pl-c1">self</span>.savepath <span class="pl-k">+</span> <span class="pl-c1">self</span>.afterfilename</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L188" class="blob-num js-line-number" data-line-number="188"></td>
        <td id="file-videoserver-py-LC188" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c"><span class="pl-c">#</span> record the frames "after" motion</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L189" class="blob-num js-line-number" data-line-number="189"></td>
        <td id="file-videoserver-py-LC189" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">self</span>.camera.split_recording(<span class="pl-c1">self</span>.afterfilepath)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L190" class="blob-num js-line-number" data-line-number="190"></td>
        <td id="file-videoserver-py-LC190" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c"><span class="pl-c">#</span> Write the 10 seconds "before" motion to disk as well</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L191" class="blob-num js-line-number" data-line-number="191"></td>
        <td id="file-videoserver-py-LC191" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">self</span>.write_video(<span class="pl-c1">self</span>.stream, <span class="pl-c1">self</span>.beforefilepath)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L192" class="blob-num js-line-number" data-line-number="192"></td>
        <td id="file-videoserver-py-LC192" class="blob-code blob-code-inner js-file-line">                </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L193" class="blob-num js-line-number" data-line-number="193"></td>
        <td id="file-videoserver-py-LC193" class="blob-code blob-code-inner js-file-line">                            <span class="pl-k">while</span> <span class="pl-c1">self</span>.videoStarted <span class="pl-k">and</span> (time.time()<span class="pl-k">&lt;</span>(<span class="pl-c1">self</span>.startTime <span class="pl-k">+</span> <span class="pl-c1">self</span>.recordDuration)):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L194" class="blob-num js-line-number" data-line-number="194"></td>
        <td id="file-videoserver-py-LC194" class="blob-code blob-code-inner js-file-line">                                <span class="pl-c1">self</span>.camera.wait_recording(<span class="pl-c1">0.001</span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L195" class="blob-num js-line-number" data-line-number="195"></td>
        <td id="file-videoserver-py-LC195" class="blob-code blob-code-inner js-file-line">                </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L196" class="blob-num js-line-number" data-line-number="196"></td>
        <td id="file-videoserver-py-LC196" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">self</span>.stopVideo() <span class="pl-c"><span class="pl-c">#</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L197" class="blob-num js-line-number" data-line-number="197"></td>
        <td id="file-videoserver-py-LC197" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">self</span>.camera.split_recording(<span class="pl-c1">self</span>.stream)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L198" class="blob-num js-line-number" data-line-number="198"></td>
        <td id="file-videoserver-py-LC198" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span>VideoServer received self.videoStarted==0 or past recordDuration<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L199" class="blob-num js-line-number" data-line-number="199"></td>
        <td id="file-videoserver-py-LC199" class="blob-code blob-code-inner js-file-line">                        </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L200" class="blob-num js-line-number" data-line-number="200"></td>
        <td id="file-videoserver-py-LC200" class="blob-code blob-code-inner js-file-line">                        <span class="pl-c"><span class="pl-c">#</span>capture a foo.jpg frame every stillInterval seconds</span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L201" class="blob-num js-line-number" data-line-number="201"></td>
        <td id="file-videoserver-py-LC201" class="blob-code blob-code-inner js-file-line">                        thistime <span class="pl-k">=</span> time.time()</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L202" class="blob-num js-line-number" data-line-number="202"></td>
        <td id="file-videoserver-py-LC202" class="blob-code blob-code-inner js-file-line">                        <span class="pl-k">if</span> <span class="pl-c1">self</span>.doTimelapse <span class="pl-k">and</span> thistime <span class="pl-k">&gt;</span> (lasttime<span class="pl-k">+</span><span class="pl-c1">self</span>.stillinterval):</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L203" class="blob-num js-line-number" data-line-number="203"></td>
        <td id="file-videoserver-py-LC203" class="blob-code blob-code-inner js-file-line">                            lasttime <span class="pl-k">=</span> thistime</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L204" class="blob-num js-line-number" data-line-number="204"></td>
        <td id="file-videoserver-py-LC204" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">self</span>.lastimage <span class="pl-k">=</span> <span class="pl-c1">self</span>.GetTimestamp() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>.jpg<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L205" class="blob-num js-line-number" data-line-number="205"></td>
        <td id="file-videoserver-py-LC205" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>capturing still frame:<span class="pl-pds">'</span></span>, <span class="pl-c1">self</span>.lastimage</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L206" class="blob-num js-line-number" data-line-number="206"></td>
        <td id="file-videoserver-py-LC206" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">self</span>.camera.capture(<span class="pl-c1">self</span>.savepath <span class="pl-k">+</span> <span class="pl-c1">self</span>.lastimage, <span class="pl-v">use_video_port</span><span class="pl-k">=</span><span class="pl-c1">True</span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L207" class="blob-num js-line-number" data-line-number="207"></td>
        <td id="file-videoserver-py-LC207" class="blob-code blob-code-inner js-file-line">            </td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L208" class="blob-num js-line-number" data-line-number="208"></td>
        <td id="file-videoserver-py-LC208" class="blob-code blob-code-inner js-file-line">                        <span class="pl-c1">self</span>.beforefilename <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L209" class="blob-num js-line-number" data-line-number="209"></td>
        <td id="file-videoserver-py-LC209" class="blob-code blob-code-inner js-file-line">                        <span class="pl-c1">self</span>.afterfilename <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L210" class="blob-num js-line-number" data-line-number="210"></td>
        <td id="file-videoserver-py-LC210" class="blob-code blob-code-inner js-file-line">                        <span class="pl-c1">self</span>.beforefilepath <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L211" class="blob-num js-line-number" data-line-number="211"></td>
        <td id="file-videoserver-py-LC211" class="blob-code blob-code-inner js-file-line">                        <span class="pl-c1">self</span>.afterfilepath <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L212" class="blob-num js-line-number" data-line-number="212"></td>
        <td id="file-videoserver-py-LC212" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">except</span>:</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L213" class="blob-num js-line-number" data-line-number="213"></td>
        <td id="file-videoserver-py-LC213" class="blob-code blob-code-inner js-file-line">                        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span>VideoServer except clause --&gt;&gt;ERROR<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L214" class="blob-num js-line-number" data-line-number="214"></td>
        <td id="file-videoserver-py-LC214" class="blob-code blob-code-inner js-file-line">                <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span>VideoServer.run fell out of loop<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L215" class="blob-num js-line-number" data-line-number="215"></td>
        <td id="file-videoserver-py-LC215" class="blob-code blob-code-inner js-file-line">            time.sleep(<span class="pl-c1">0.05</span>)</td>
      </tr>
      <tr>
        <td id="file-videoserver-py-L216" class="blob-num js-line-number" data-line-number="216"></td>
        <td id="file-videoserver-py-LC216" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span>VideoServer terminating [is never called]<span class="pl-pds">'</span></span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/cudmore/c4ab92d288cfd1778be5/raw/445e2d13411641f5559b08fe9b8e9e1ad336a7cc/VideoServer.py" style="float:right">view raw</a>
        <a href="https://gist.github.com/cudmore/c4ab92d288cfd1778be5#file-videoserver-py">VideoServer.py</a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>



</div>

<div class="post-tags">
  Tags: 
  
  
  <a href="http://blog.cudmore.io/tags/#raspberry">raspberry</a>,
  
  <a href="http://blog.cudmore.io/tags/#linux">linux</a>,
  
  <a href="http://blog.cudmore.io/tags/#flask">flask</a>
  
</div>


<div class="post-tags">
    <p><font size="-1rem">©2018. <a href="http://robertcudmore.org/">Robert Cudmore</a>.</font></p>
</div>


<span class="page-nav-item-left">
    <a rel="prev" href="http://blog.cudmore.io/post/2015/12/05/raspberry-wifi/" title="View Raspberry Wifi">« Older</a>
</span>


<span class="page-nav-item-right">
    <a rel="next" href="http://blog.cudmore.io/post/2016/01/19/MQTT/" title="View ">Newer »</a>
</span>



    </div>


  

<div id="weava-permanent-marker" date="1535097630260"></div><div id="weava-ui-wrapper"><div class="weava-drop-area-wrapper"><div class="weava-drop-area"></div>
<div class="weava-drop-area-text">Drop here!</div></div><iframe id="weava-popover-iframe" scrolling="no" frameborder="0" src="./Camera with a REST interface · Robert Cudmore_files/popover-index.html" style="height: 77px !important; top: 315px; left: 716.688px; display: none;"></iframe></div></body><span class="gr__tooltip"><span class="gr__tooltip-content"></span><i class="gr__tooltip-logo"></i><span class="gr__triangle"></span></span></html>